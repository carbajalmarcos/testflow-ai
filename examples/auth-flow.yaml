# Auth flow â€” Login, use token, access protected resource.

name: Authentication Flow
description: Login and access a protected endpoint using the returned token
tags:
  - auth
  - smoke

steps:
  - name: Login
    request:
      method: POST
      url: "{api}/auth/login"
      headers:
        Content-Type: application/json
      body:
        email: admin@example.com
        password: secret
    capture:
      - name: token
        path: data.accessToken
      - name: userId
        path: data.user.id
    assertions:
      - path: status
        operator: equals
        value: 200
      - path: data.accessToken
        operator: exists

  - name: Access protected route
    request:
      method: GET
      url: "{api}/users/${userId}"
      headers:
        Authorization: "Bearer ${token}"
    assertions:
      - path: status
        operator: equals
        value: 200
      - path: data.id
        operator: equals
        value: "${userId}"

  - name: Reject without token
    request:
      method: GET
      url: "{api}/users/${userId}"
    assertions:
      - path: status
        operator: equals
        value: 401
