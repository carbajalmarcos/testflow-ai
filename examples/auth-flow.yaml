# Auth flow â€” Login, use token, create and access a protected todo.

name: Authenticated Todo Flow
description: Login, create a todo with auth token, and verify access control
tags:
  - auth
  - todos
  - smoke

steps:
  - name: Login
    request:
      method: POST
      url: "{api}/auth/login"
      headers:
        Content-Type: application/json
      body:
        email: admin@example.com
        password: secret
    capture:
      - name: token
        path: data.accessToken
    assertions:
      - path: status
        operator: equals
        value: 200
      - path: data.accessToken
        operator: exists

  - name: Create todo (authenticated)
    request:
      method: POST
      url: "{api}/todos"
      headers:
        Content-Type: application/json
        Authorization: "Bearer ${token}"
      body:
        title: "Deploy to production"
        completed: false
    capture:
      - name: todoId
        path: data.id
    assertions:
      - path: status
        operator: equals
        value: 201
      - path: data.title
        operator: equals
        value: "Deploy to production"

  - name: Read todo (authenticated)
    request:
      method: GET
      url: "{api}/todos/${todoId}"
      headers:
        Authorization: "Bearer ${token}"
    assertions:
      - path: status
        operator: equals
        value: 200
      - path: data.id
        operator: equals
        value: "${todoId}"

  - name: Reject without token
    request:
      method: POST
      url: "{api}/todos"
      headers:
        Content-Type: application/json
      body:
        title: "Should fail"
    assertions:
      - path: status
        operator: equals
        value: 401
